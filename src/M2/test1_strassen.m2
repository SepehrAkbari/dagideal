-- Graph-Constrained Secant Variety
-- Tensor Shape: [3, 3, 3], CP Rank: 2

kk = ZZ/32003
R = kk[v_(0,0,0), v_(0,0,1), v_(0,1,0), v_(0,1,1), v_(0,2,0), v_(0,2,1), v_(1,0,0), v_(1,0,1), v_(1,1,0), v_(1,1,1), v_(1,2,0), v_(1,2,1), v_(2,0,1), v_(2,1,0), v_(2,1,1), v_(2,2,0), v_(2,2,1), t_(0,0,0), t_(0,0,1), t_(0,0,2), t_(0,1,0), t_(0,1,1), t_(0,1,2), t_(0,2,0), t_(0,2,1), t_(0,2,2), t_(1,0,0), t_(1,0,1), t_(1,0,2), t_(1,1,0), t_(1,1,1), t_(1,1,2), t_(1,2,0), t_(1,2,1), t_(1,2,2), t_(2,0,0), t_(2,0,1), t_(2,0,2), t_(2,1,0), t_(2,1,1), t_(2,1,2), t_(2,2,0), t_(2,2,1), t_(2,2,2)]

I_cp = ideal(
    t_(0,0,0) - (v_(0,0,1)*v_(1,0,1)*v_(2,0,1)),
    t_(0,0,1) - (v_(0,0,0)*v_(1,0,0)*v_(2,1,0) + v_(0,0,1)*v_(1,0,1)*v_(2,1,1)),
    t_(0,0,2) - (v_(0,0,0)*v_(1,0,0)*v_(2,2,0) + v_(0,0,1)*v_(1,0,1)*v_(2,2,1)),
    t_(0,1,0) - (v_(0,0,1)*v_(1,1,1)*v_(2,0,1)),
    t_(0,1,1) - (v_(0,0,0)*v_(1,1,0)*v_(2,1,0) + v_(0,0,1)*v_(1,1,1)*v_(2,1,1)),
    t_(0,1,2) - (v_(0,0,0)*v_(1,1,0)*v_(2,2,0) + v_(0,0,1)*v_(1,1,1)*v_(2,2,1)),
    t_(0,2,0) - (v_(0,0,1)*v_(1,2,1)*v_(2,0,1)),
    t_(0,2,1) - (v_(0,0,0)*v_(1,2,0)*v_(2,1,0) + v_(0,0,1)*v_(1,2,1)*v_(2,1,1)),
    t_(0,2,2) - (v_(0,0,0)*v_(1,2,0)*v_(2,2,0) + v_(0,0,1)*v_(1,2,1)*v_(2,2,1)),
    t_(1,0,0) - (v_(0,1,1)*v_(1,0,1)*v_(2,0,1)),
    t_(1,0,1) - (v_(0,1,0)*v_(1,0,0)*v_(2,1,0) + v_(0,1,1)*v_(1,0,1)*v_(2,1,1)),
    t_(1,0,2) - (v_(0,1,0)*v_(1,0,0)*v_(2,2,0) + v_(0,1,1)*v_(1,0,1)*v_(2,2,1)),
    t_(1,1,0) - (v_(0,1,1)*v_(1,1,1)*v_(2,0,1)),
    t_(1,1,1) - (v_(0,1,0)*v_(1,1,0)*v_(2,1,0) + v_(0,1,1)*v_(1,1,1)*v_(2,1,1)),
    t_(1,1,2) - (v_(0,1,0)*v_(1,1,0)*v_(2,2,0) + v_(0,1,1)*v_(1,1,1)*v_(2,2,1)),
    t_(1,2,0) - (v_(0,1,1)*v_(1,2,1)*v_(2,0,1)),
    t_(1,2,1) - (v_(0,1,0)*v_(1,2,0)*v_(2,1,0) + v_(0,1,1)*v_(1,2,1)*v_(2,1,1)),
    t_(1,2,2) - (v_(0,1,0)*v_(1,2,0)*v_(2,2,0) + v_(0,1,1)*v_(1,2,1)*v_(2,2,1)),
    t_(2,0,0) - (v_(0,2,1)*v_(1,0,1)*v_(2,0,1)),
    t_(2,0,1) - (v_(0,2,0)*v_(1,0,0)*v_(2,1,0) + v_(0,2,1)*v_(1,0,1)*v_(2,1,1)),
    t_(2,0,2) - (v_(0,2,0)*v_(1,0,0)*v_(2,2,0) + v_(0,2,1)*v_(1,0,1)*v_(2,2,1)),
    t_(2,1,0) - (v_(0,2,1)*v_(1,1,1)*v_(2,0,1)),
    t_(2,1,1) - (v_(0,2,0)*v_(1,1,0)*v_(2,1,0) + v_(0,2,1)*v_(1,1,1)*v_(2,1,1)),
    t_(2,1,2) - (v_(0,2,0)*v_(1,1,0)*v_(2,2,0) + v_(0,2,1)*v_(1,1,1)*v_(2,2,1)),
    t_(2,2,0) - (v_(0,2,1)*v_(1,2,1)*v_(2,0,1)),
    t_(2,2,1) - (v_(0,2,0)*v_(1,2,0)*v_(2,1,0) + v_(0,2,1)*v_(1,2,1)*v_(2,1,1)),
    t_(2,2,2) - (v_(0,2,0)*v_(1,2,0)*v_(2,2,0) + v_(0,2,1)*v_(1,2,1)*v_(2,2,1))
)

-- Constructing Slices for Strassen's Equations
X_0 = matrix{
    {t_(0,0,0), t_(0,0,1), t_(0,0,2)},
    {t_(0,1,0), t_(0,1,1), t_(0,1,2)},
    {t_(0,2,0), t_(0,2,1), t_(0,2,2)}
}
X_1 = matrix{
    {t_(1,0,0), t_(1,0,1), t_(1,0,2)},
    {t_(1,1,0), t_(1,1,1), t_(1,1,2)},
    {t_(1,2,0), t_(1,2,1), t_(1,2,2)}
}
X_2 = matrix{
    {t_(2,0,0), t_(2,0,1), t_(2,0,2)},
    {t_(2,1,0), t_(2,1,1), t_(2,1,2)},
    {t_(2,2,0), t_(2,2,1), t_(2,2,2)}
}

-- Helper function for the 3x3 Adjugate
adj = M -> matrix {
    { det submatrix(M,{1,2},{1,2}), -det submatrix(M,{0,2},{1,2}),  det submatrix(M,{0,1},{1,2}) },
    {-det submatrix(M,{1,2},{0,2}),  det submatrix(M,{0,2},{0,2}), -det submatrix(M,{0,1},{0,2}) },
    { det submatrix(M,{1,2},{0,1}), -det submatrix(M,{0,2},{0,1}),  det submatrix(M,{0,1},{0,1}) }
}

-- Computing the Strassen Matrix: X0*adj(X1)*X2 - X2*adj(X1)*X0
S_matrix = X_0 * adj(X_1) * X_2 - X_2 * adj(X_1) * X_0
strassenIdeal = ideal flatten entries S_matrix

-- Implicit equations by elimination
factorVars = {v_(0,0,0), v_(0,0,1), v_(0,1,0), v_(0,1,1), v_(0,2,0), v_(0,2,1), v_(1,0,0), v_(1,0,1), v_(1,1,0), v_(1,1,1), v_(1,2,0), v_(1,2,1), v_(2,0,1), v_(2,1,0), v_(2,1,1), v_(2,2,0), v_(2,2,1)}
J = eliminate(factorVars, I_cp + strassenIdeal)

print "Betti Table of the Generators"
print net betti gens J

